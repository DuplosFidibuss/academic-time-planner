@page "/"
@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@using Plotly.Blazor.LayoutLib

@if (ChartsState.Value.Loaded)
{
    <p>Unlinked Toggl projects (@ProjectsData!.UnlinkedTogglProjects.Count): @ProjectsData!.GetUnlinkedTogglProjectsAsString()</p>

    <PlotlyChart Id="Total" Config="config" Layout="layoutTotal" Data=GetDataTotal()/>
    <PlotlyChart Id="Projects" Config="config" Layout="layoutProjects" Data=GetDataOfSingleProjectsToday()/>

    @if (!ChartsState.Value.LoadedFiltered)
    {
        <EditForm Model="@DateFilter" OnSubmit="@SetDateFilter">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <label>Start date: <InputDate id="StartDate" @bind-Value="DateFilter.StartDate" /></label>
            <label>End date: <InputDate id="EndDate" @bind-Value="DateFilter.EndDate" /></label>
            <button type="submit">Set filter</button>
        </EditForm>

        <p>No valid filter time range submitted.</p>
    }
    else
    {
        @foreach(var project in ProjectsData.PlanProjects)
        {
            <PlotlyChart Id="@project.Name" Config="config" Layout="GetLayout(project.Name)" Data="GetDataOfSingleProjectsFiltered(project)" />
        }        
        <button type="button" class="btn btn-secondary" @onclick="ChangeFilter">Reset filter</button>
    }
}

